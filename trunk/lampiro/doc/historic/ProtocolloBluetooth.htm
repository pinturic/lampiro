<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>ProtocolloBluetooth - Wiki del Coso</title>
<script type="text/javascript" src="/coso/wiki/htdocs/common/js/common.js"></script>

<script type="text/javascript">
<!--// common functions

// We keep here the state of the search box
searchIsDisabled = false;

function searchChange(e) {
    // Update search buttons status according to search box content.
    // Ignore empty or whitespace search term.
    var value = e.value.replace(/\s+/, '');
    if (value == '' || searchIsDisabled) { 
        searchSetDisabled(true);
    } else {
        searchSetDisabled(false);
    }
}

function searchSetDisabled(flag) {
    // Enable or disable search
    document.getElementById('fullsearch').disabled = flag;
    document.getElementById('titlesearch').disabled = flag;
}

function searchFocus(e) {
    // Update search input content on focus
    if (e.value == 'Search') {
        e.value = '';
        e.className = '';
        searchIsDisabled = false;
    }
}

function searchBlur(e) {
    // Update search input content on blur
    if (e.value == '') {
        e.value = 'Search';
        e.className = 'disabled';
        searchIsDisabled = true;
    }
}

function actionsMenuInit(title) {
    // Initialize action menu
    for (i = 0; i < document.forms.length; i++) {
        var form = document.forms[i];
        if (form.className == 'actionsmenu') {
            // Check if this form needs update
            var div = form.getElementsByTagName('div')[0];
            var label = div.getElementsByTagName('label')[0];
            if (label) {
                // This is the first time: remove label and do buton.
                div.removeChild(label);
                var dobutton = div.getElementsByTagName('input')[0];
                div.removeChild(dobutton);
                // and add menu title
                var select = div.getElementsByTagName('select')[0];
                var item = document.createElement('option');
                item.appendChild(document.createTextNode(title));
                item.value = 'show';
                select.insertBefore(item, select.options[0]);
                select.selectedIndex = 0;
            }
        }
    }
}
//-->
</script>

<script type="text/javascript">
var gui_editor_link_href = "/coso/wiki/moin.cgi/ProtocolloBluetooth?action=edit&editor=gui";
var gui_editor_link_text = "Edit (GUI)";
</script>        

<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/coso/wiki/htdocs/classic/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/coso/wiki/htdocs/classic/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/coso/wiki/htdocs/classic/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="/coso/wiki/htdocs/classic/css/projection.css">


<link rel="Start" href="/coso/wiki/moin.cgi/HelpOnLanguages">
<link rel="Alternate" title="Formattazione Wiki" href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=raw">
<link rel="Alternate" media="print" title="Versione stampabile" href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=print">
<link rel="Search" href="/coso/wiki/moin.cgi/CercaPagina">
<link rel="Index" href="/coso/wiki/moin.cgi/IndiceDeiTitoli">
<link rel="Glossary" href="/coso/wiki/moin.cgi/IndicePerParola">
<link rel="Help" href="/coso/wiki/moin.cgi/AiutoSuFormattazione">
</head>

<body  lang="it" dir="ltr">



<div id="header">
<div id="logo"><a href="/coso/wiki/moin.cgi/HelpOnLanguages">Wiki del Coso</a></div>

<form id="searchform" method="get" action="">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Cerca:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titoli" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Testo" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a class="nonexistent nonexistent" href="/coso/wiki/moin.cgi/LucianoMollea" title="LucianoMollea @ Self">LucianoMollea</a></li><li><a href="/coso/wiki/moin.cgi/PreferenzeUtente">PreferenzeUtente</a></li><li><form action="" method="POST">
<input type="hidden" name="action" value="userform">
<input type="submit" name="logout" value="Logout">
</form>
</li></ul>
<div id="locationline">


<ul id="pagelocation">
<li><a class="backlink" title="Clicca qui per effettuare una ricerca full-text per questo titolo" href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=fullsearch&amp;value=linkto%3A%22ProtocolloBluetooth%22&amp;context=180">ProtocolloBluetooth</a></li>
</ul>

</div>

<ul id="pagetrail">
<li><a href="/coso/wiki/moin.cgi/ModificheRecenti">ModificheRecenti</a></li><li><a href="/coso/wiki/moin.cgi/BookMark">BookMark</a></li><li><a href="/coso/wiki/moin.cgi/ParserXMLJ2Me">ParserXMLJ2Me</a></li><li><a href="/coso/wiki/moin.cgi/FrontPage">FrontPage</a></li><li><a href="/coso/wiki/moin.cgi/ProtocolloBluetooth">ProtocolloBluetooth</a></li>
</ul>
<ul id="iconbar">
<li><a title="Modifica" href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=edit"><img alt="Modifica" height="12" src="/coso/wiki/htdocs/classic/img/moin-edit.png" title="Modifica" width="12" /></a></li>
<li><a title="mostra" href="/coso/wiki/moin.cgi/ProtocolloBluetooth"><img alt="mostra" height="13" src="/coso/wiki/htdocs/classic/img/moin-show.png" title="mostra" width="12" /></a></li>
<li><a title="differenze" href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=diff"><img alt="differenze" height="11" src="/coso/wiki/htdocs/classic/img/moin-diff.png" title="differenze" width="15" /></a></li>
<li><a title="Informazioni" href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=info"><img alt="Informazioni" height="11" src="/coso/wiki/htdocs/classic/img/moin-info.png" title="Informazioni" width="12" /></a></li>
<li><a title="Sottoscrivi" href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=subscribe"><img alt="Sottoscrivi" height="10" src="/coso/wiki/htdocs/classic/img/moin-subscribe.png" title="Sottoscrivi" width="14" /></a></li>
<li><a title="Non formattato" href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=raw"><img alt="Non formattato" height="13" src="/coso/wiki/htdocs/classic/img/moin-raw.png" title="Non formattato" width="12" /></a></li>
<li><a title="Versione stampabile" href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=print"><img alt="Versione stampabile" height="14" src="/coso/wiki/htdocs/classic/img/moin-print.png" title="Versione stampabile" width="16" /></a></li>
</ul>


<ul id="navibar">
<li class="wikilink"><a href="/coso/wiki/moin.cgi/HelpOnLanguages">HelpOnLanguages</a></li><li class="wikilink"><a href="/coso/wiki/moin.cgi/ModificheRecenti">ModificheRecenti</a></li><li class="wikilink"><a href="/coso/wiki/moin.cgi/CercaPagina">CercaPagina</a></li><li class="wikilink"><a href="/coso/wiki/moin.cgi/AiutoContenuti">AiutoContenuti</a></li><li class="current"><a href="/coso/wiki/moin.cgi/ProtocolloBluetooth">ProtocolloBluetooth</a></li>
</ul>


</div>



<div id="page" lang="en" dir="ltr">

<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span>
<h1 id="head-0fba1219912553b74399019355b32811cf8635b7">Protocollo su Bluetooth</h1>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line886">RFCOMM con è così affidabile come sembra (sappiamo da esperimenti fatti), almenoRFCOMM lo sarebbe, ma le implementazioni sui cellulari fanno schifo come al solito. Occorre quini prendere accorgimenti: <span class="anchor" id="line-4"></span></p><span class="anchor" id="line-5"></span><ul><li><p class="line886">Il cellulare deve scoprire qual è l'MTU e occorre comunicarla al Cosillo in modo che non viaggino mai pacchetti più grandi <span class="anchor" id="line-6"></span></p></li><li><p class="line886">Meglio fare un handshake per ogni pacchetto, in modo da evitare che vi sia più di un pacchetto accodato <span class="anchor" id="line-7"></span></p></li><li><p class="line886">Inserire i pacchetti RFCOMM in un frame in modo da facilitare l'handshake <span class="anchor" id="line-8"></span></p><span class="anchor" id="line-9"></span></li></ul>
<h2 id="head-7473a910eafa9f7f1818b62757a2b17327a46212">Frame</h2>
<span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line886">Formato: | 1 | 2 | n | <span class="anchor" id="line-12"></span>Campi: <span class="anchor" id="line-13"></span></p><ol type="1"><li><p class="line903"><a class="nonexistent nonexistent" href="/coso/wiki/moin.cgi/PacketType">PacketType</a> (1 byte), sempre presente <span class="anchor" id="line-14"></span></p><ul><li><p class="line886">. MTU, value: 0 <span class="anchor" id="line-15"></span></p></li><li><p class="line886">. DATA, value: 1 <span class="anchor" id="line-16"></span></p></li><li><p class="line886">. ACK, value: 2 <span class="anchor" id="line-17"></span></p></li></ul></li><li><p class="line903"><a class="nonexistent nonexistent" href="/coso/wiki/moin.cgi/PayloadLength">PayloadLength</a> (2 byte), sempre presente, lunghezza del payload (anche 0) <span class="anchor" id="line-18"></span></p></li><li><p class="line886">Payload (0...MTU-3), significato diverso a seconda del tipo di pacchetto: <span class="anchor" id="line-19"></span></p><ul><li><p class="line879">MTU (2 byte): che indicano la MTU (potrei riciclare il <a class="nonexistent nonexistent" href="/coso/wiki/moin.cgi/PayloadLength">PayloadLength</a>, intanto in questo caso il payload è sempre lungo uguale, ma credo non ne valga la pena, visto che corro solo il rischio di complicare il parser) <span class="anchor" id="line-20"></span></p></li><li><p class="line879">DATA (variabile): esattamente gli n byte indicati da <a class="nonexistent nonexistent" href="/coso/wiki/moin.cgi/PayloadLength">PayloadLength</a> <span class="anchor" id="line-21"></span></p></li><li><p class="line886">ACK (0 byte): no payload <span class="anchor" id="line-22"></span></p><span class="anchor" id="line-23"></span></li></ul></li></ol><p class="line886">Nota: tutte le lunghezze sono codificate in network order <span class="anchor" id="line-24"></span></p><span class="anchor" id="line-25"></span>
<h2 id="head-b21fd95d617fa2b01c8b8d0b95d5236ad60055c3">Protocollo</h2>
<span class="anchor" id="line-26"></span><p class="line886">Indipendentemente da chi apre la connessione (cosillo o cellulare), è sempre il cellulare che inzia ad inviare dati: <span class="anchor" id="line-27"></span></p><span class="anchor" id="line-28"></span><ol type="1"><li><p class="line886">Il cellulare invia un pacchetto in cui informa il coso della propria MTU (5byte in tutto) <span class="anchor" id="line-29"></span></p></li><li><p class="line886">Il cosillo invia un ACK <span class="anchor" id="line-30"></span></p></li><li><p class="line886">da qui in avanti ogni pacchetto dati, in ambo le direzioni, viene inserito in frame come descritto sopra ed il successivo viene inviato solo previo ack <span class="anchor" id="line-31"></span></p><span class="anchor" id="line-32"></span></li></ol>
<h2 id="head-29c15e6f326063186740bc9c897b715f514442b9">Note</h2>
<span class="anchor" id="line-33"></span><p class="line886">Potendo giocare sul tipo tipo di pacchetti, senza sconvolgere il programma, si può pensare and un meccanismo in cui il client, contestualmente all'invio della MTU, presenta una sfida al cosillo (il cosillo risponde solo se può collegarsi con il cosone, quindi se è fidato). Se il cosillo non è in grado di rispondere, il client sa che si sta connettendo con un flaso cosillo e non va avanti. Im questo modo potremmo avere sicurezza a livello di link, senza doverci spremere troppo ad un livello più alto <span class="anchor" id="line-34"></span></p><span class="anchor" id="line-35"></span>
<h2 id="head-5b50d342fecb74679c49e190ecfa57b0c7ae0699">Addenda</h2>
<span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><ul><li><p class="line886">Aggiungere logica inquiry/ordine di connessione <span class="anchor" id="line-38"></span></p></li></ul><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="it" dir="ltr">ProtocolloBluetooth  (l'ultima modifica è del 2005-12-28 22:19:45, fatta da <span title="SciaSbat @ 213-156-52-110.fastres.net[213.156.52.110]"><a class="nonexistent nonexistent" href="/coso/wiki/moin.cgi/SciaSbat" title="SciaSbat @ 213-156-52-110.fastres.net[213.156.52.110]">SciaSbat</a></span>)</p>

<div id="pagebottom"></div>
</div>


<div id="footer"><ul class="editbar"><li><a name="texteditlink" href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=edit&amp;editor=text">Edit (Text)</a></li></ul><p><a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=refresh">CancellaFileTemporanei</a> (2006-03-19 21:12:56 in cache)</p><p>Oppure prova una di queste azioni: <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=AttachFile">Attach File</a>, <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=DeletePage">Cancella Pagina</a>, <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=Despam">Despam</a>, <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=LikePages">Like Pages</a>, <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=LocalSiteMap">Local Site Map</a>, <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=MyPages">My Pages</a>, <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=PackagePages">Package Pages</a>, <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=RenamePage">Rinomina Pagina</a>, <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=RenderAsDocbook">Render As Docbook</a>, <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=SpellCheck">Spell Check</a>, <a href="/coso/wiki/moin.cgi/ProtocolloBluetooth?action=SubscribeUser">Subscribe User</a></p>
</div>
<ul id="credits">
<li><a href="http://moinmoin.wikiwikiweb.de/">MoinMoin Powered</a></li><li><a href="http://www.python.org/">Python Powered</a></li><li><a href="http://validator.w3.org/check?uri=referer">Valid HTML 4.01</a></li>
</ul>


<ul id="timings">
<li>getACL = 0.004s</li>
<li>run = 0.236s</li>
<li>send_page = 0.225s</li>
<li>send_page_content = 0.008s</li>
<li>total = 0.272s</li>
</ul>
</body>
</html>

